<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Lemur Express Employee Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            min-height: 100vh; 
            overflow-x: hidden;
        }
        .header { 
            background: rgba(0, 0, 0, 0.2); 
            padding: 15px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            backdrop-filter: blur(10px); 
        }
        .logo { font-size: 1.5em; font-weight: bold; }
        .container { padding: 20px; max-width: 500px; margin: 0 auto; }
        .dashboard-card { 
            background: rgba(255, 255, 255, 0.15); 
            border-radius: 15px; 
            padding: 20px; 
            margin-bottom: 20px; 
            backdrop-filter: blur(10px); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
        }
        .button { 
            background: rgba(255, 255, 255, 0.2); 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            color: white; 
            font-weight: bold; 
            width: 100%; 
            margin-bottom: 10px; 
            cursor: pointer; 
        }
        .button:hover { background: rgba(255, 255, 255, 0.3); }
        .status { 
            background: #4CAF50; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.8em; 
        }
        .order-list { max-height: 400px; overflow-y: auto; }
        .order-item { 
            background: rgba(255, 255, 255, 0.1); 
            margin-bottom: 10px; 
            padding: 15px; 
            border-radius: 10px; 
        }
        .error { 
            background: rgba(255, 0, 0, 0.2); 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }
        .loading { text-align: center; padding: 40px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üçï Lemur Express</div>
        <div class="status" id="status">ONLINE</div>
    </div>

    <div class="container">
        <div class="dashboard-card">
            <h2>Employee Dashboard</h2>
            <div id="error-message" class="error" style="display: none;"></div>
            <div id="loading" class="loading">Loading orders...</div>
            <div id="orders-container" style="display: none;">
                <h3>Active Orders</h3>
                <div id="orders-list" class="order-list"></div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>Quick Actions</h3>
            <button class="button" onclick="refreshOrders()">üîÑ Refresh Orders</button>
            <button class="button" onclick="testConnection()">üîó Test Connection</button>
            <button class="button" onclick="clearCache()">üßπ Clear Cache</button>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let orders = [];

        async function fetchOrders() {
            try {
                document.getElementById('status').textContent = 'LOADING';
                document.getElementById('status').style.background = '#FF9800';
                
                const response = await fetch(`${API_BASE}/api/orders`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                orders = await response.json();
                displayOrders();
                
                document.getElementById('status').textContent = 'ONLINE';
                document.getElementById('status').style.background = '#4CAF50';
                document.getElementById('error-message').style.display = 'none';
                
            } catch (error) {
                console.error('Failed to fetch orders:', error);
                showError(`Connection failed: ${error.message}`);
                
                document.getElementById('status').textContent = 'OFFLINE';
                document.getElementById('status').style.background = '#F44336';
            }
        }

        function displayOrders() {
            const container = document.getElementById('orders-list');
            const loading = document.getElementById('loading');
            const ordersContainer = document.getElementById('orders-container');
            
            loading.style.display = 'none';
            ordersContainer.style.display = 'block';
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="order-item">No active orders</div>';
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="order-item">
                    <div><strong>Order #${order.id}</strong></div>
                    <div>Customer: ${order.customerInfo?.firstName || 'Unknown'}</div>
                    <div>Status: ${order.status}</div>
                    <div>Total: $${order.total}</div>
                    <div style="margin-top: 10px;">
                        <button class="button" onclick="updateOrderStatus(${order.id}, 'preparing')" style="margin-bottom: 5px;">Start Preparing</button>
                        <button class="button" onclick="updateOrderStatus(${order.id}, 'ready')" style="margin-bottom: 5px;">Mark Ready</button>
                        <button class="button" onclick="updateOrderStatus(${order.id}, 'completed')">Complete Order</button>
                    </div>
                </div>
            `).join('');
        }

        async function updateOrderStatus(orderId, status) {
            try {
                const response = await fetch(`${API_BASE}/api/orders/${orderId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status })
                });
                
                if (response.ok) {
                    await fetchOrders(); // Refresh
                } else {
                    throw new Error(`Failed to update order: ${response.status}`);
                }
            } catch (error) {
                showError(`Failed to update order: ${error.message}`);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        async function refreshOrders() {
            await fetchOrders();
        }

        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                alert(`Connection OK: ${data.server}`);
            } catch (error) {
                alert(`Connection failed: ${error.message}`);
            }
        }

        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }

        // Auto-refresh every 10 seconds
        setInterval(fetchOrders, 10000);
        
        // Initial load
        fetchOrders();
    </script>
</body>
</html>